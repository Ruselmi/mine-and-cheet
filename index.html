<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sosiologi Pro: Secure Exam Browser</title>
    
    <!-- React & Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f1f5f9; 
            user-select: none; /* Mencegah blok teks */
        }
        
        /* SECURITY OVERLAY */
        .lock-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: red;
            text-align: center;
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Sembunyikan Scrollbar saat ujian */
        .no-scroll { overflow: hidden; }
    </style>
</head>
<body oncontextmenu="return false;"> <!-- Matikan Klik Kanan Global -->

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. DATABASE TEMPLATE YANG DIPERLUAS (AGAR TIDAK KEMBAR) ---
        // Kita butuh variasi topik yang banyak agar 100 soal terasa unik.
        
        const subjects = ["Pak Andi", "Bu Siti", "Rina", "Budi", "Warga Desa Sukamaju", "Kelompok Remaja", "Pak RT", "Seorang Mahasiswa", "Para Buruh", "Ketua OSIS", "Peneliti Asing", "Komunitas Adat"];
        const contexts = ["di lingkungan sekolah", "di pasar tradisional", "di media sosial", "saat rapat desa", "dalam kegiatan gotong royong", "saat demonstrasi", "di perkantoran modern", "di daerah konflik"];

        // Bank Soal Latihan (Konsep Dasar & Kehidupan)
        // Saya menambahkan variasi logika agar generator bisa membuat kombinasi unik
        const narrativeTemplates = [
            { q: "mengajak warga membersihkan selokan setiap hari Minggu secara sukarela.", t: "Interaksi", a: "Gotong Royong", w: ["Kooptasi", "Persaingan", "Akomodasi", "Asimilasi"], e: "Kerja sama sukarela untuk tujuan bersama." },
            { q: "meniru gaya berpakaian idola K-Pop agar terlihat kekinian.", t: "Faktor Interaksi", a: "Imitasi", w: ["Identifikasi", "Sugesti", "Simpati", "Empati"], e: "Imitasi hanya meniru fisik luaran." },
            { q: "sangat ingin menjadi sama persis (identik) dengan tokoh idolanya hingga mengubah kepribadian.", t: "Faktor Interaksi", a: "Identifikasi", w: ["Imitasi", "Sugesti", "Simpati", "Motivasi"], e: "Identifikasi lebih mendalam daripada imitasi." },
            { q: "merasa iba melihat pengemis lalu memberikan uang.", t: "Faktor Interaksi", a: "Empati", w: ["Simpati", "Sugesti", "Imitasi", "Identifikasi"], e: "Empati diikuti tindakan nyata." },
            { q: "mendapat gelar bangsawan karena keturunan orang tua.", t: "Status", a: "Ascribed Status", w: ["Achieved Status", "Assigned Status", "Symbolic Status", "Role Conflict"], e: "Didapat otomatis lewat kelahiran." },
            { q: "menjadi direktur perusahaan karena kerja keras dan prestasi.", t: "Status", a: "Achieved Status", w: ["Ascribed Status", "Assigned Status", "Symbolic Status", "Latent Status"], e: "Didapat melalui usaha." },
            { q: "diberi gelar pahlawan oleh pemerintah karena jasanya.", t: "Status", a: "Assigned Status", w: ["Ascribed Status", "Achieved Status", "Role Status", "Active Status"], e: "Diberikan oleh pihak lain atas jasa." },
            { q: "mengalami kebingungan karena harus memilih antara tugas polisi atau membela anaknya yang bersalah.", t: "Peran", a: "Konflik Peran", w: ["Kegagalan Peran", "Kesenjangan Peran", "Ketegangan Peran", "Jarak Peran"], e: "Tuntutan peran yang bertabrakan." },
            { q: "tidak menilai baik buruknya fakta kemacetan, hanya mencatat data.", t: "Ciri Sosiologi", a: "Non-Etis", w: ["Empiris", "Teoritis", "Kumulatif", "Spekulatif"], e: "Sosiologi bersifat netral/objektif." },
            { q: "menyusun teori baru berdasarkan teori-teori lama yang diperbaiki.", t: "Ciri Sosiologi", a: "Kumulatif", w: ["Empiris", "Non-Etis", "Teoritis", "Kritis"], e: "Teori berkembang dari yang sudah ada." },
            { q: "mengamati data langsung di lapangan, bukan menduga-duga.", t: "Ciri Sosiologi", a: "Empiris", w: ["Teoritis", "Kumulatif", "Non-Etis", "Normatif"], e: "Berdasarkan observasi fakta." },
            { q: "selalu menyapa orang yang lebih tua karena takut dicemooh warga.", t: "Norma", a: "Norma Kesopanan", w: ["Norma Hukum", "Norma Agama", "Norma Kesusilaan", "Cara (Usage)"], e: "Bersumber dari adat pergaulan, sanksi cemoohan." },
            { q: "merasa berdosa dan takut hukuman Tuhan jika tidak beribadah.", t: "Norma", a: "Norma Agama", w: ["Norma Hukum", "Norma Kesopanan", "Norma Kesusilaan", "Adat Istiadat"], e: "Bersumber dari Tuhan." },
            { q: "merasa bersalah dalam hati setelah berbohong meski tidak ada yang tahu.", t: "Norma", a: "Norma Kesusilaan", w: ["Norma Kesopanan", "Norma Hukum", "Norma Agama", "Kebiasaan"], e: "Bersumber dari hati nurani." },
            { q: "ditilang polisi karena melanggar lampu merah.", t: "Norma", a: "Norma Hukum", w: ["Norma Agama", "Norma Kesusilaan", "Norma Kesopanan", "Tata Kelakuan"], e: "Sanksi tegas dan memaksa dari negara." },
            { q: "menggunakan gadget mewah hanya demi gengsi dan pamer.", t: "Gejala Sosial", a: "Hedonisme", w: ["Westernisasi", "Sekularisme", "Modernisasi", "Globalisasi"], e: "Mengejar kesenangan materi semata." },
            { q: "terlibat tawuran antar pelajar untuk mempertahankan nama sekolah.", t: "Interaksi", a: "Konflik (Pertentangan)", w: ["Kompetisi", "Kontravensi", "Akomodasi", "Asimilasi"], e: "Bentuk disosiatif dengan kekerasan." },
            { q: "bersaing secara sehat dalam olimpiade sains untuk menjadi juara.", t: "Interaksi", a: "Kompetisi", w: ["Konflik", "Kontravensi", "Koersi", "Amalgamasi"], e: "Bersaing tanpa kekerasan." },
            { q: "menjadi penengah netral dalam konflik warga tanpa memihak.", t: "Akomodasi", a: "Mediasi", w: ["Arbitrase", "Ajudikasi", "Koersi", "Kompromi"], e: "Pihak ketiga hanya penasihat." },
            { q: "memutuskan perkara sengketa tanah di pengadilan secara mengikat.", t: "Akomodasi", a: "Ajudikasi", w: ["Mediasi", "Arbitrase", "Koersi", "Konsiliasi"], e: "Penyelesaian lewat pengadilan." }
        ];

        // Bank Soal HOTS (Teori & Analisis)
        const hotsTemplates = [
            { q: "Fenomena 'Citayam Fashion Week' sebagai resistensi kelas bawah terhadap budaya elit Sudirman. Analisis Teori Konflik Marx melihat ini sebagai...", a: "Pertentangan kelas simbolik", w: ["Solidaritas organik", "Fungsi manifes hiburan", "Tindakan tradisional", "Asimilasi budaya"], e: "Perebutan ruang publik antara kelas proletar dan borjuis." },
            { q: "Masyarakat menolak vaksinasi karena dianggap melanggar kepercayaan leluhur. Menurut Weber, ini adalah...", a: "Tindakan Rasional Nilai", w: ["Tindakan Instrumental", "Tindakan Afektif", "Tindakan Tradisional", "Irasional"], e: "Tindakan sadar demi mempertahankan nilai absolut." },
            { q: "Sekolah menerapkan kurikulum yang bias kelas menengah, membuat anak miskin gagal. Bourdieu menyebut ini...", a: "Kekerasan Simbolik", w: ["Mobilitas Vertikal", "Meritokrasi", "Fungsi Laten", "Disorganisasi"], e: "Dominasi budaya yang dipaksakan secara halus." },
            { q: "Tingginya angka bunuh diri saat krisis ekonomi karena hilangnya pegangan norma. Durkheim menyebutnya...", a: "Anomie", w: ["Alienasi", "Egoistik", "Altruistik", "Cultural Lag"], e: "Kondisi tanpa norma/kebingungan aturan." },
            { q: "Penggunaan CCTV di seluruh kota mendisiplinkan tubuh warga agar patuh. Foucault menyebut konsep ini...", a: "Panopticon", w: ["Iron Cage", "Dramaturgi", "Habitus", "Verstehen"], e: "Pengawasan total yang membuat individu mendisiplinkan diri sendiri." },
            { q: "Birokrasi modern menjebak manusia dalam aturan kaku yang mematikan kreativitas. Weber menyebutnya...", a: "Iron Cage (Kerangkeng Besi)", w: ["Anomie", "Alienasi", "Habitus", "Hyperreality"], e: "Rasionalitas yang berlebihan mengekang kebebasan manusia." },
            { q: "Buruh merasa asing dengan produk yang dibuatnya sendiri karena ia hanya menjadi sekrup mesin. Marx menyebut ini...", a: "Alienasi", w: ["Anomie", "Hegemoni", "Fetisisme Komoditas", "Solidaritas Mekanik"], e: "Keterasingan pekerja dari hasil karyanya." },
            { q: "Masyarakat desa berubah dari ikatan batin menjadi ikatan kepentingan bisnis. Tonnies menyebut peralihan ini...", a: "Gemeinschaft ke Gesellschaft", w: ["Mekanik ke Organik", "Tradisional ke Modern", "Paguyuban ke Patembayan", "In-Group ke Out-Group"], e: "Perubahan dari paguyuban ke patembayan." },
            { q: "Realitas media sosial menjadi lebih nyata daripada kenyataan itu sendiri (hiperrealitas). Tokohnya adalah...", a: "Jean Baudrillard", w: ["Karl Marx", "Max Weber", "Auguste Comte", "Talcott Parsons"], e: "Simulacra dan Hiperrealitas." },
            { q: "Perubahan sosial tidak selalu linier, bisa saja mundur atau berputar (Siklus). Teori ini dikemukakan...", a: "Ibnu Khaldun / Sorokin", w: ["Auguste Comte", "Spencer", "Darwin", "Parsons"], e: "Teori Siklus melihat peradaban lahir, tumbuh, dan mati." }
        ];

        // --- 2. LOGIKA GENERATOR UNIK ---

        const shuffle = (array) => array.sort(() => Math.random() - 0.5);

        const generateUniqueQuestions = (mode) => {
            const targetCount = mode === 'LATIHAN' ? 100 : 50;
            const templates = mode === 'LATIHAN' ? narrativeTemplates : hotsTemplates;
            const generatedSet = new Set(); // Untuk mencegah duplikasi narasi persis
            const finalQuestions = [];
            
            let id = 1;
            let safetyCounter = 0; // Mencegah infinite loop

            while (finalQuestions.length < targetCount && safetyCounter < 1000) {
                // 1. Pilih Template Acak
                const tpl = templates[Math.floor(Math.random() * templates.length)];
                
                // 2. Pilih Subjek & Konteks Acak
                const subj = subjects[Math.floor(Math.random() * subjects.length)];
                const ctx = contexts[Math.floor(Math.random() * contexts.length)];
                
                // 3. Rakit Narasi
                let text = "";
                if (mode === 'LATIHAN') {
                    // Narasi sehari-hari
                    text = `${subj} ${ctx} ${tpl.q}`;
                    // Variasi struktur kalimat agar tidak monoton
                    if (Math.random() > 0.5) text = `Pada saat ${ctx}, ${subj} ${tpl.q}`;
                } else {
                    // Narasi Akademik HOTS
                    const intros = ["Analisis Kasus:", "Dalam perspektif sosiologi kritis:", "Fenomena sosial menunjukkan:"];
                    const intro = intros[Math.floor(Math.random() * intros.length)];
                    text = `${intro} ${tpl.q} Hal ini terlihat pada kasus ${subj} ${ctx}.`;
                }

                // 4. Cek Keunikan (Jika teks sudah ada, skip)
                if (!generatedSet.has(text)) {
                    generatedSet.add(text);
                    
                    // 5. Acak Jawaban
                    const opts = shuffle([
                        { text: tpl.a, correct: true },
                        { text: tpl.w[0], correct: false },
                        { text: tpl.w[1], correct: false },
                        { text: tpl.w[2], correct: false },
                        { text: tpl.w[3], correct: false }
                    ]);

                    finalQuestions.push({
                        id: id++,
                        text: text,
                        category: tpl.t || "Analisis",
                        options: opts,
                        explanation: tpl.e
                    });
                }
                safetyCounter++;
            }
            return finalQuestions;
        };

        // --- 3. KOMPONEN UTAMA ---

        function App() {
            const [view, setView] = React.useState('MENU'); 
            const [mode, setMode] = React.useState(null);
            const [questions, setQuestions] = React.useState([]);
            const [currentIdx, setCurrentIdx] = React.useState(0);
            const [answers, setAnswers] = React.useState({});
            const [timeLeft, setTimeLeft] = React.useState(0);
            
            // SECURITY STATES
            const [isLocked, setIsLocked] = React.useState(false);
            const [violationCount, setViolationCount] = React.useState(0);
            const [showSidebar, setShowSidebar] = React.useState(false);

            // --- FUNGSI KEAMANAN & FULLSCREEN ---
            
            const enterFullscreen = () => {
                const elem = document.documentElement;
                if (elem.requestFullscreen) elem.requestFullscreen().catch(err => console.log(err));
                else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
            };

            // Deteksi Keluar / Blur / Notifikasi Overlay
            React.useEffect(() => {
                if (view !== 'QUIZ' || mode !== 'UJIAN') return;

                const handleVisibility = () => {
                    if (document.hidden) triggerLock("Mendeteksi perpindahan Tab/Aplikasi!");
                };

                const handleBlur = () => {
                    // Blur terjadi jika user klik notifikasi atau alt-tab
                    triggerLock("Layar kehilangan fokus! Jangan buka notifikasi.");
                };

                const handleFullscreenChange = () => {
                    if (!document.fullscreenElement) {
                        triggerLock("Dilarang keluar dari Mode Fullscreen!");
                    }
                };

                document.addEventListener("visibilitychange", handleVisibility);
                window.addEventListener("blur", handleBlur);
                document.addEventListener("fullscreenchange", handleFullscreenChange);

                // Mencegah refresh/back button
                window.onbeforeunload = () => "Anda sedang ujian!";

                return () => {
                    document.removeEventListener("visibilitychange", handleVisibility);
                    window.removeEventListener("blur", handleBlur);
                    document.removeEventListener("fullscreenchange", handleFullscreenChange);
                    window.onbeforeunload = null;
                };
            }, [view, mode]);

            const triggerLock = (reason) => {
                setViolationCount(prev => {
                    const newCount = prev + 1;
                    if (newCount >= 3) {
                        finishQuiz(true); // Diskualifikasi
                        return newCount;
                    }
                    return newCount;
                });
                setIsLocked(true);
            };

            const unlockScreen = () => {
                enterFullscreen();
                setIsLocked(false);
            };

            // --- LOGIKA UTAMA ---

            const startQuiz = (selectedMode) => {
                const q = generateUniqueQuestions(selectedMode);
                setQuestions(q);
                setMode(selectedMode);
                setView('QUIZ');
                setAnswers({});
                setCurrentIdx(0);
                setViolationCount(0);
                setIsLocked(false);
                
                if (selectedMode === 'UJIAN') {
                    enterFullscreen();
                    setTimeLeft(90 * 60); // 90 Menit
                } else {
                    setTimeLeft(0);
                }
            };

            const handleAnswer = (option) => {
                // Di mode latihan, jika sudah jawab, tidak bisa ubah agar bisa lihat pembahasan
                if (mode === 'LATIHAN' && answers[currentIdx]) return;
                
                setAnswers(prev => ({
                    ...prev,
                    [currentIdx]: { isCorrect: option.correct, text: option.text }
                }));
            };

            const jumpTo = (idx) => {
                setCurrentIdx(idx);
                setShowSidebar(false);
            };

            const nextQ = () => {
                if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);
                else finishQuiz(false);
            };

            const finishQuiz = (disqualified = false) => {
                if (document.fullscreenElement) document.exitFullscreen().catch(e => {});
                if (disqualified) {
                    alert("ANDA DIDISKUALIFIKASI KARENA MELANGGAR ATURAN KEAMANAN 3 KALI.");
                    setView('MENU');
                } else {
                    setView('RESULT');
                }
            };

            // Timer
            React.useEffect(() => {
                if (view === 'QUIZ' && mode === 'UJIAN' && timeLeft > 0 && !isLocked) {
                    const timer = setInterval(() => setTimeLeft(t => t - 1), 1000);
                    return () => clearInterval(timer);
                } else if (timeLeft === 0 && view === 'QUIZ' && mode === 'UJIAN') {
                    finishQuiz(false);
                }
            }, [timeLeft, view, mode, isLocked]);

            const formatTime = (s) => {
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${m}:${sec < 10 ? '0' : ''}${sec}`;
            };

            // --- RENDER ---

            // 1. LAYAR TERKUNCI (SECURITY)
            if (isLocked) {
                return (
                    <div className="lock-screen font-mono">
                        <i className="ph-fill ph-lock-key text-8xl mb-4 animate-bounce"></i>
                        <h1 className="text-4xl font-bold mb-2">SECURITY LOCKOUT</h1>
                        <p className="text-xl mb-6 text-white">Sistem mendeteksi aktivitas mencurigakan.</p>
                        
                        <div className="bg-red-900/50 p-6 rounded-xl border border-red-500 mb-8">
                            <h2 className="text-2xl font-bold text-red-400">PELANGGARAN {violationCount}/3</h2>
                            <p className="text-sm text-red-200 mt-2">Jika mencapai 3, ujian otomatis GAGAL.</p>
                        </div>

                        <button onClick={unlockScreen} className="bg-white text-red-900 px-8 py-3 rounded-full font-bold hover:bg-gray-200 transition">
                            KEMBALI KE UJIAN (FULLSCREEN)
                        </button>
                    </div>
                );
            }

            // 2. MENU UTAMA
            if (view === 'MENU') {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6">
                        <div className="max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-8 fade-in">
                            <div className="text-center md:col-span-2 text-white mb-4">
                                <h1 className="text-4xl font-bold mb-2">Sosiologi <span className="text-blue-500">Secure Browser</span></h1>
                                <p className="text-slate-400">Platform Ujian & Latihan Terproteksi</p>
                            </div>

                            <button onClick={() => startQuiz('LATIHAN')} className="bg-emerald-600 hover:bg-emerald-700 text-white p-6 rounded-2xl text-left shadow-lg group transition hover:-translate-y-1">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="bg-emerald-800 p-3 rounded-lg"><i className="ph-fill ph-student text-2xl"></i></div>
                                    <span className="bg-emerald-800 text-xs font-bold px-2 py-1 rounded">100 SOAL</span>
                                </div>
                                <h2 className="text-2xl font-bold mb-1">Mode Latihan</h2>
                                <p className="text-emerald-100 text-sm mb-4">Belajar santai dengan pembahasan langsung.</p>
                                <ul className="text-sm space-y-1 opacity-80">
                                    <li>‚úÖ Navigasi Soal Bebas</li>
                                    <li>‚úÖ Pembahasan Tiap Nomor</li>
                                    <li>‚úÖ Tanpa Timer</li>
                                </ul>
                            </button>

                            <button onClick={() => startQuiz('UJIAN')} className="bg-rose-600 hover:bg-rose-700 text-white p-6 rounded-2xl text-left shadow-lg group transition hover:-translate-y-1">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="bg-rose-800 p-3 rounded-lg"><i className="ph-fill ph-shield-check text-2xl"></i></div>
                                    <span className="bg-rose-800 text-xs font-bold px-2 py-1 rounded">50 HOTS</span>
                                </div>
                                <h2 className="text-2xl font-bold mb-1">Mode Ujian Aman</h2>
                                <p className="text-rose-100 text-sm mb-4">Simulasi ujian ketat dengan sistem keamanan.</p>
                                <ul className="text-sm space-y-1 opacity-80">
                                    <li>üîí <b>Layar Terkunci (Kiosk)</b></li>
                                    <li>‚ö†Ô∏è Deteksi Keluar Aplikasi</li>
                                    <li>‚è±Ô∏è Waktu 90 Menit</li>
                                </ul>
                            </button>
                        </div>
                    </div>
                );
            }

            // 3. LAYAR KUIS
            if (view === 'QUIZ') {
                const q = questions[currentIdx];
                const ans = answers[currentIdx];
                const themeClass = mode === 'LATIHAN' ? 'bg-emerald-50 text-slate-800' : 'bg-slate-900 text-white';
                
                return (
                    <div className={`h-screen flex flex-col md:flex-row overflow-hidden ${themeClass}`}>
                        
                        {/* SIDEBAR NAVIGASI (Hanya Latihan atau Toggle di Ujian) */}
                        <div className={`
                            fixed md:relative z-20 w-72 h-full bg-white text-slate-800 shadow-xl transform transition-transform duration-300 flex flex-col
                            ${showSidebar ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}
                            ${mode === 'UJIAN' ? 'md:hidden' : ''} 
                        `}>
                            <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                                <h3 className="font-bold text-sm uppercase">Peta Soal</h3>
                                <button onClick={() => setShowSidebar(false)} className="md:hidden"><i className="ph-bold ph-x"></i></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-2">
                                <div className="grid grid-cols-5 gap-2">
                                    {questions.map((_, i) => {
                                        let statusClass = "bg-slate-100 text-slate-400";
                                        if (i === currentIdx) statusClass = "bg-blue-600 text-white ring-2 ring-blue-300";
                                        else if (answers[i]) {
                                            if (mode === 'LATIHAN') statusClass = answers[i].isCorrect ? "bg-emerald-500 text-white" : "bg-red-500 text-white";
                                            else statusClass = "bg-slate-700 text-white"; // Ujian tidak kasih spoiler
                                        }
                                        return (
                                            <button key={i} onClick={() => jumpTo(i)} className={`aspect-square rounded text-xs font-bold ${statusClass}`}>
                                                {i + 1}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* KONTEN UTAMA */}
                        <div className="flex-1 flex flex-col h-full relative">
                            {/* Header */}
                            <div className={`px-6 py-3 flex justify-between items-center z-10 shadow-sm ${mode === 'LATIHAN' ? 'bg-white' : 'bg-slate-800 border-b border-slate-700'}`}>
                                <div className="flex items-center gap-3">
                                    <button onClick={() => setShowSidebar(true)} className="md:hidden p-2 rounded bg-slate-200 text-slate-700"><i className="ph-bold ph-list"></i></button>
                                    <span className="font-bold">{mode}</span>
                                </div>
                                
                                {mode === 'UJIAN' && (
                                    <div className="flex items-center gap-4">
                                        <div className="hidden md:flex items-center gap-2 text-xs font-bold text-rose-500 bg-rose-900/20 px-3 py-1 rounded border border-rose-500/50 animate-pulse">
                                            <i className="ph-fill ph-lock-key"></i> SECURE MODE
                                        </div>
                                        <div className="font-mono text-xl font-bold bg-slate-900 px-3 py-1 rounded border border-slate-600 text-white">
                                            {formatTime(timeLeft)}
                                        </div>
                                    </div>
                                )}
                                
                                <button onClick={() => finishQuiz(false)} className="text-sm font-bold opacity-60 hover:opacity-100">Selesai</button>
                            </div>

                            {/* Area Soal */}
                            <div className="flex-1 overflow-y-auto p-6 md:p-10 relative">
                                <div className="max-w-3xl mx-auto pb-12">
                                    <div className="flex justify-between text-xs font-bold uppercase tracking-widest opacity-50 mb-2">
                                        <span>Soal {currentIdx + 1}</span>
                                        <span>{q.category}</span>
                                    </div>

                                    {/* Soal Box */}
                                    <div className={`p-6 md:p-8 rounded-2xl mb-6 shadow-sm border-2 ${mode === 'LATIHAN' ? 'bg-white border-transparent' : 'bg-slate-800 border-slate-700'}`}>
                                        <p className="text-lg md:text-xl leading-relaxed narrative-text select-none">{q.text}</p>
                                    </div>

                                    {/* Opsi Jawaban */}
                                    <div className="space-y-3">
                                        {q.options.map((opt, i) => {
                                            const isSelected = ans && ans.text === opt.text;
                                            let btnClass = "w-full text-left p-4 rounded-xl border-2 flex items-center transition-all select-none ";
                                            
                                            if (mode === 'LATIHAN') {
                                                if (ans) {
                                                    if (opt.correct) btnClass += "bg-emerald-100 border-emerald-500 text-emerald-900";
                                                    else if (isSelected) btnClass += "bg-red-100 border-red-500 text-red-900";
                                                    else btnClass += "bg-white border-slate-100 opacity-50";
                                                } else {
                                                    btnClass += "bg-white border-slate-200 hover:border-emerald-400 hover:bg-emerald-50";
                                                }
                                            } else {
                                                // UJIAN
                                                if (ans) {
                                                    if (isSelected) btnClass += "bg-blue-600 border-blue-500 text-white shadow-lg";
                                                    else btnClass += "bg-slate-800 border-slate-700 opacity-50";
                                                } else {
                                                    btnClass += "bg-slate-800 border-slate-700 hover:bg-slate-700 hover:border-slate-500 text-slate-300";
                                                }
                                            }

                                            return (
                                                <button key={i} onClick={() => handleAnswer(opt)} disabled={!!ans && mode === 'LATIHAN'} className={btnClass}>
                                                    <span className="w-8 h-8 rounded-full border flex items-center justify-center mr-4 text-xs font-bold opacity-70">
                                                        {String.fromCharCode(65 + i)}
                                                    </span>
                                                    <span className="font-medium">{opt.text}</span>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {/* Pembahasan (Hanya Latihan) */}
                                    {mode === 'LATIHAN' && ans && (
                                        <div className="mt-8 p-6 bg-emerald-100 border-l-4 border-emerald-500 rounded-r-xl fade-in text-emerald-900">
                                            <h4 className="font-bold flex items-center gap-2 mb-2"><i className="ph-fill ph-lightbulb"></i> Pembahasan</h4>
                                            <p className="text-sm leading-relaxed">{q.explanation}</p>
                                        </div>
                                    )}

                                    {/* Navigasi Bawah */}
                                    <div className="mt-10 flex justify-end">
                                        <button onClick={nextQ} className={`px-8 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 ${mode === 'LATIHAN' ? 'bg-emerald-600 text-white hover:bg-emerald-700' : 'bg-blue-600 text-white hover:bg-blue-700'}`}>
                                            {currentIdx === questions.length - 1 ? 'Lihat Hasil' : 'Selanjutnya'} <i className="ph-bold ph-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 4. HASIL
            if (view === 'RESULT') {
                const score = Math.round((Object.values(answers).filter(a => a.isCorrect).length / questions.length) * 100);
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 text-white">
                        <div className="bg-slate-800 p-8 rounded-3xl max-w-md w-full text-center shadow-2xl fade-in border border-slate-700">
                            <h2 className="text-3xl font-bold mb-6">Hasil Akhir</h2>
                            <div className={`text-7xl font-black mb-2 ${score > 75 ? 'text-emerald-400' : 'text-rose-400'}`}>{score}</div>
                            <div className="inline-block px-3 py-1 bg-slate-900 rounded-full text-xs font-bold text-slate-400 mb-8 border border-slate-600">SKOR FINAL</div>
                            
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <div className="bg-emerald-900/30 border border-emerald-500/30 p-4 rounded-xl text-emerald-400">
                                    <div className="text-2xl font-bold">{Object.values(answers).filter(a => a.isCorrect).length}</div>
                                    <div className="text-xs font-bold opacity-70">BENAR</div>
                                </div>
                                <div className="bg-rose-900/30 border border-rose-500/30 p-4 rounded-xl text-rose-400">
                                    <div className="text-2xl font-bold">{questions.length - Object.values(answers).filter(a => a.isCorrect).length}</div>
                                    <div className="text-xs font-bold opacity-70">SALAH</div>
                                </div>
                            </div>
                            
                            <button onClick={() => setView('MENU')} className="w-full bg-white text-slate-900 font-bold py-4 rounded-xl hover:bg-slate-200 transition">Kembali ke Menu</button>
                        </div>
                    </div>
                );
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


